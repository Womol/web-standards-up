# WebStandards Days

## 2015-10-31, Минск, Белоруссия

Доброе утро, Вадим Макеев открывает наш маленький  [#wstdays](https://twitter.com/search?q=%23wstdays)-сабантуй

В программе небольшое изменение: доклад про V8 будет сегодня.

Павел Ловцевич немного рассказал про историю [#wstdays](https://twitter.com/search?q=%23wstdays) — всё началось с 2009, вы можете отмотать календарь на главной [webstandardsdays.ru](https://t.co/WoaaKUMTOI "http://webstandardsdays.ru/")

Первый доклад: «Вызов принят», Аня Селезнёва.

Слайды доклада: [askd.rocks/pres/rd-wsd/](https://t.co/6efjVCtDcP "http://askd.rocks/pres/rd-wsd/")

Немного Хеллоуина на этой конференции. [pic.twitter.com/4If8OBHXSB](https://t.co/4If8OBHXSB)

![](https://pbs.twimg.com/media/CSoNUgvWwAAoQ8i.jpg)

Рассказ будет про нестандартные сайты, которые запоминаются надолго.

Один из профитов от создания таких сайтов — известность, как для разработчиков, так и для заказчиков.

Например, тот сайт над которым работала анина команда, попал в список [tympanus.net/codrops/collec…](https://t.co/SxeQNiJHbm "http://tympanus.net/codrops/collective/collective-171/")

Вот что получилось: [rdcm.com/en/](https://t.co/fpvoBH9V9Q "http://rdcm.com/en/")

3D браузере похоже на обычную систему координат, только вверх ногами [pic.twitter.com/51bERTW1AO](https://t.co/51bERTW1AO)

![](https://pbs.twimg.com/media/CSoOs9OUkAAtv3O.png)

А потом просто собираем кубик в браузере. Тут нужно смотреть анимацию [askd.rocks/pres/rd-wsd/?f…](https://t.co/t2Xi0ePeD4 "http://askd.rocks/pres/rd-wsd/?full#12")

Текст в 3D становится крупнее и чуть размывается, потому что грани объекта как бы выходят за пределы экрана.

Фиксится просто — нужно «задвинуть» куб чуть вдаль.

Всё вроде просто. Но немного не работает в IE10-11.

А всё от того, что в  IE не работает preserve3d.

В итоге пришлось всё переделать и добавить к граням свойство backface-visibility: hidden

В IE всё стало хорошо. Но теперь стало сильно хуже в Chrome. [askd.rocks/pres/rd-wsd/?f…](https://t.co/qYChiNEi7m "http://askd.rocks/pres/rd-wsd/?full#28")

В итоге, решили сделать два куба. Один для IE,  второй для всех остальных

Feature detection через Modernizr провалилась. Пришлось написать свою маленькую проверку. [pic.twitter.com/Ksva5oyPYf](https://t.co/Ksva5oyPYf)

![](https://pbs.twimg.com/media/CSoRDtOWwAAelRT.png)

«Простите за то, что дышу» говорит нам Аня.

Всё было почти хорошо. Но у нас есть ещё один браузер... [pic.twitter.com/xM4svVaJ0U](https://t.co/xM4svVaJ0U)

![](https://pbs.twimg.com/media/CSoRtoRVAAAcyAf.png)

В FF куда-то пропадал дополнительный блок, который позволял управлять вращением сцены.

И тут оказалось, что баг не в ff, а в реальном мире, который воспроизводится в FF правильно, а у других — нет. [pic.twitter.com/pW9V3O4Dh5](https://t.co/pW9V3O4Dh5)

![](https://pbs.twimg.com/media/CSoSVHhUYAAR8Bc.png)

А ещё был параллакс, но с ним было всё просто. Немного тригонометрии из программы 9 класса. [pic.twitter.com/IvoVnSLkk3](https://t.co/IvoVnSLkk3)

![](https://pbs.twimg.com/media/CSoSsVKWsAA4qp9.png)

Ещё нужно было использовать размытие. К сожалению, css-фильтры не кроссбраузерны и странно работают.

В итоге был использован svg-фильтр, который тоже слегка не работает в IE, но это фиксится.

Чтобы большие картинки грузились быстрее — сначала сервер отдаёт сильно уменьшенную и размытую картинку, потом загрузить большую и показать.

Ну а в скором времени можно будет уйти от костылей с фильтрами. Когда придёт backdrop-filter: blur\(\)

— Зачем всё это сделано с помощью CSS, который работает везде по разному?  
— Мне нравится делать всё с помощью вещей, в которых я уверена

[@olmokhov](https://twitter.com/olmokhov "Олег Мохов") передали камера-мэнам. Обещали починить.

Второй доклад — «СSS Modules. Предотвращая проблемы», Павел Ловцевич.

Павел считает, что CSS Modules, это самая горячая тема этого года после [#СитникХватит](https://twitter.com/search?q=%23СитникХватит)

Слайды доклада  [webstandardsdays.ru/2015/10/31/pre…](https://t.co/K9HvthUeZF "http://webstandardsdays.ru/2015/10/31/pres/css-modules/")

Проблема CSS — его придумали для стилизации документов, а не приложений.

Мы можем сломать страницу 1000 и 1 способом, просто использую стандартные возможности CSS.

Не нужно использовать глобальные сущности, говорит нам W3C. Который придумал CSS с глобальной областью видимости.

Для JS, HTML, SVG есть возможности инкапсуляции, а вот с CSS всё сложнее. Да есть @-правила, но этого мало.

Но Марти уже прилетел, поэтому скоро нас ждёт светлое будущее и CSS Scoping Module.

Как-то так. [pic.twitter.com/WZw3PDFqtv](https://t.co/WZw3PDFqtv)

![](https://pbs.twimg.com/media/CSoZh7aUkAAmqn9.png)

Черновик спецификации [drafts.csswg.org/css-scoping/](https://t.co/WLal84sxTK "https://drafts.csswg.org/css-scoping/")

Сейчас мы вынуждены решать проблему использую соглашения об именах, методологии, BEM, OOCSS, SMACSS — вот это всё.

Подробнее в статье «Способы организации CSS-кода»: [habrahabr.ru/post/256109/](https://t.co/cHlbSmDDwV "http://habrahabr.ru/post/256109/")

Второй способ решения проблемы — добавление ещё одного уровня абстракции, типа SASS/LESS/Stylus/PostCSS

Недостатки:  
— разделение кода на две версии, для dev и prod  
— +1 точка отказа  
— Необходимость координации команды

Ещё можно использовать Inline CSS, но лучше вообще не будем об этом даже думать.

Что же нам несут CSS Modules?  
1. настоящая изоляция;  
2. удобное повторное использование.

CSS Module позволяет использовать более простые классы, чем БЭМ и при этом ничего не сломать.

На самом деле, CSS Modules создаёт ещё более длинные классы чем БЭМ, но делает «за сценой».

Так же CSS Modules даёт нам удобный способ для композиции стилей.

Также можно шарить код между компонентами, но без загрязнения глобальной области видимости, как это просиходит в случае с SASS/LESS/Stylus.

Попробовать CSS Modules можно уже сейчас. Вот ссылки на доступные инструменты [webstandardsdays.ru/2015/10/31/pre…](https://t.co/yG0SUSmG5z "http://webstandardsdays.ru/2015/10/31/pres/css-modules/?full#78")

[@andrey\_sitnik](https://twitter.com/andrey_sitnik "Андрей Ситник") можешь спросить у него сегодня лично.

[@olmokhov](https://twitter.com/olmokhov "Олег Мохов") ок. Если что ещё отвалится — пиши.

Третий доклад. «Как работает V8 и почему так быстро» от Димы Малеева.

Слайды доклада — [webstandardsdays.ru/2015/10/31/pre…](https://t.co/qgSLBz2zZz "http://webstandardsdays.ru/2015/10/31/pres/3-v8-so-fast.pdf")

V8 делают в Германии, а там автобаны, мерседесы и вообще давно умеют делать быстрые вещи.

[@talgautb](https://twitter.com/talgautb "Талга УтБ") теперь есть?

Теперь демо в которой сравнивается скорость поиска простых чисел в реализации на C++ и V8.

v8 — 5.53s против 1.98 в C++.

Но можно немного всё оптимизировать.

Под капотом V8 создаёт скрытые классы.

2\. Желательно не использовать числа типа Double.

Разреженные массивы — тоже плохо. Внутри они превращаются словарь, с доступом по ключу-числу.

При создании массива — нужно, чтобы в нём был как минимум один элемент, иначе V8 сохранит его как sparse array.

Элементы массива должны быть одного типа. Иначе V8 будет делать дополнительные трансформации внутри.

Если всё-таки так надо — сразу создавайте массив в литеральной форме со всеми значениями.

/\*\* Так плохо \*/  
let a = \[1\];  
a\[1\] = 2;  
a\[2\] = \[2.33\];  
a\[3\] = true;  
/\*\* Так хорошо \*/  
let b = \[1, 2, 2.33, true\];

[@zenwalker](https://twitter.com/zenwalker "Maxim Poletaev") вроде поднялась.

V8 может использовать как оптимизацию, так и деоптимизацию.

Деоптимизацию может вызвать передача в функции аргументов «внезапного» типа. Например складывали числа 10 раз, а потом передали строку.

Дев-версию v8 можно запустить с ключом --prof, который логирует всё с точностью 1мс. Который потом можно проанализировать.

Поглядели на лог, поглядели на код. Нашли баг и пришли к времени выполнения близкому с C++ реализацией.

RT [@rdvornov](https://twitter.com/rdvornov "Roman Dvornov"): О чем говорят фронтенды на [#wstdays](https://twitter.com/search?q=%23wstdays)? Обо всем, и даже об ассемблере! ;\) [pic.twitter.com/kAHGA2Ru6V](https://t.co/kAHGA2Ru6V)

![](https://pbs.twimg.com/media/CSooSiLW4AAt3OE.jpg)

Четвёртый доклад — «Кросс-проектные компоненты», Артёма Мезин

Слайды презентации [webstandardsdays.ru/2015/10/31/pre…](https://t.co/SfiMndcszH "http://webstandardsdays.ru/2015/10/31/pres/components/")

В почте mail.ru — четыре команды и в какой-то момент стало понятно, что нужна общая библиотека блоков.

RT [@webnotbombs\_by](https://twitter.com/webnotbombs_by "Web Not Bombs"): [#wstdays](https://twitter.com/search?q=%23wstdays) [#minsk](https://twitter.com/search?q=%23minsk) [pic.twitter.com/WRBbYEqajr](https://t.co/WRBbYEqajr)

![](https://pbs.twimg.com/media/CSoutcdVEAEo6On.jpg)

Два подхода к созданию такой библиотеки — отдельная команда разботчиков библиотеки или выдать всем общие гайдлайны.

В итоге, выбрали другой путь — общая библиотека, которую разрабатывают все команды совместно.

Чтобы библиотека хорошо вписалась в процесс разработки нужно, чтобы выполнялись эти семь правил. [pic.twitter.com/PRpW1J2ET9](https://t.co/PRpW1J2ET9)

![](https://pbs.twimg.com/media/CSovmk3WsAA5PGU.png)

Подключение библиотеки удобнее делать через npm, что в целом очевидно.

Удобство в том, что в любой момент пакет из npm можно переключить на git-зависимость, пофиксить нужное и раскатать на стейдже.

Но в реальности пакеты распространяются не через npm или bower, а собственный jam [github.com/mailru/jam](https://t.co/X28N1IP2Eo "https://github.com/mailru/jam")

Однако, теперь есть npm@3, с плоскими зависимостями и поэтому лучше использовать его.

Очень важно синхронизировать версию пакета и гит-ревизию. Тут помогают гит-теги.

Вот какая-то такая довольно простая схема. [pic.twitter.com/yYCOFodCXd](https://t.co/yYCOFodCXd)

![](https://pbs.twimg.com/media/CSoykBTVEAAOInY.png)

В мастере может быть нестабильная версия. И это нормально, потому что на продакшне всегда может быть только какой-то релиз.

Версионирование делается по семверу: [semver.org/lang/ru/](https://t.co/PwsNlBiYSC "http://semver.org/lang/ru/")

Публикация пакта — npm publish. И не забыть про тег.

Ну и чтобы ничего не забыть \(люди они такие\) — публикация делается на CI при помощи grunt-contrib-bump и grunt-jam-publisher

В пакет вовсе не обязательно выдирать глобальные вещи, типа библиотеки блоков. Небольшие компоненты тоже стоит так выносить.

[@DTsyrkunov](https://twitter.com/DTsyrkunov "Danik Tsyrkunov") как я понял, только потому что npm@2 не умел плоские зависимости.

Простите, но мы были вынуждены пропустить трансляцию доклада Вадима Макеева во пользу обеда.

Шестой доклад — «Автономность прежде всего» от Антона Немцева.

Слайды: [webstandardsdays.ru/2015/10/31/pre…](https://t.co/ogAubwvf79 "http://webstandardsdays.ru/2015/10/31/pres/autonomous/")

Оффлайн — это нормально.

Как узнать, что пользователь вне сети? Есть navigator.offline

Как фейсбук делать отправку сообщений, хотя пользователь вне сети? Сохраняет в сторадж, а когда сеть появляется — отправляет их.

Не хотите писать всё это руками? npm i offline-js

[@stok\_man](https://twitter.com/stok_man "uk") Антон и сам чудный чуть более, чем полностью.

А ещё есть hoodie.js

Демки в слайдах по нашей ссылке не работают, простите. Слайды лежат на нашем сервере, а демки — на локалсте у Антона.

Как hoodie решает возможные конфликты? По принципу «Кто последний — тот и папа».

Есть ли продукты на hoodie в продакшне? В общем, да.

Ещё можно постучаться к ним в слак-чат — [hood.ie/chat/](https://t.co/n24JhbVOMA "http://hood.ie/chat/")

А ещё есть swarm.js. Эта штука ещё лучше, чем hoodie. Потому что умеет правильно мержить конфликты.

При этом swarm — это библиотека, а не фреймворк. Что ещё лучше, ибо он навязывает вам архитектуру.

А ещё есть service workers, но о них Антон ничего не рассказал, потому что всё уже рассказал Вадим.

Для отладки сервис-воркеров в Chrome есть chrome://inspect\#service-workers, В Опере — browser://serviceworker-internals. В FF тоже будет.

— Куда всё кладётся в сервис-воркерах?  
— В отдельное хранилище, не в локал-стораж. Оно пока не лимитировано.

Сервис-воркер продолжает работать, работать и работать.

Седьмой доклад — «Постигаем дзен анимации: подходы на CSS и JavaScript», Александр Завьялов.

Саша работает в Яндексе, создаёт много промо-сайтов. А на них много анимаций.

Ну, вы наверно уже все знаете про магическое число 60 кадров в секунду и 16,6 мс на кадр?

А браузер ещё кучу всякой полезной работы делает, не только анимации.

Слайды: [webstandardsdays.ru/2015/10/31/pre…](https://t.co/UsGuCibfQN "http://webstandardsdays.ru/2015/10/31/pres/animation-zen/")

Полезно менять свойства так, чтобы они не тригерили перерисовку. Какие свойства «плохие»? Я просто дам ссылку [csstriggers.com](https://t.co/AiIymkLIxa "http://csstriggers.com/")

В современных браузерах можно часть работы по композингу перекладывать на GPU.

В Chrome Canary есть удобный интрумент для просмотра того, как браузер компонует страницу.

Перерисовка против перекомпоновки в картинках. В одной. [pic.twitter.com/wlQoumDcQG](https://t.co/wlQoumDcQG)

![](https://pbs.twimg.com/media/CSpeqr3UwAAriNF.png)

Анимация Opacity, Transform и Filter — хорошо, потому что работают через перекомпоновку.

Недостатки css-анимаций:   
— Неконтролируемые: только пауза и запуск  
— Рассинхронизация

Очень сложно делать несколько параллельных синхронных анимаций.

JS-анимации сложнее в обмен на значительно больший контроль.

В Яндексе используют GreenSock

Недостаток — js «забивает» и без того занятый основной поток.

CSS или JS-анимации? Ответ в табличке. [pic.twitter.com/GlCsi5OTGT](https://t.co/GlCsi5OTGT)

![](https://pbs.twimg.com/media/CSphKDxUkAAlh1r.png)

Хочется быстро, как CSS, но контролируемо, как JS? Ждём реализации спецификации Web Animations.

[@victor\_suzdalev](https://twitter.com/victor_suzdalev "Victor Suzdalev") да, потеряли важные две буквы ;\(

Трансляции доклада «Из иллюстратора в SVG» Михаила Баранова не будет. Клонирование людей по прежнему запрещено.

[@denswor](https://twitter.com/denswor "denswor"), [twitter.com/webstandards\_r…](https://t.co/6gXdTugUsf "https://twitter.com/webstandards_ru/status/660454214427131904")

Последний доклад на сегодня — «Веб-семантика, или Роботы имеют право знать», Андрей Абрамов.

Слайды — [webstandardsdays.ru/2015/10/31/pre…](https://t.co/BqPPzfzJ46 "http://webstandardsdays.ru/2015/10/31/pres/web-semantics/")

Мы делаем сайты для людей, но сайтами пользуют и роботы. И они чаще всего ничего не понимают.

Роботы — поисковики, фейсбук, слак, телеграм...

Есть три штуки, не нужно их путать:  
— микроразметка,  
— микроформаты,  
— микродата.

Микроразметка — это словарь и синткасис.

Основных словарей два — [Schema.org](https://t.co/WSeAYkioqg "http://Schema.org") и OpenGraph

Первым синтаксисом были микроформаты, потом RDFA, microdata, JSON-LD

Первые три работают поверх HTML, JSON-LD — это  &lt;script&gt;, а внутре у него джейсончик.

Микроформаты уже почти всё.

Остальные три синтаксиса используются примерно одинаково. Пока что нужно поддерживать их все.

Микроданные используют соцсети, когда вы шарите ссылки.

Поисковые сниппеты — микроразметка, которая позволяет вывести данные с сайта сразу в поисковой выдаче. [pic.twitter.com/Zbn1UZHrcJ](https://t.co/Zbn1UZHrcJ)

![](https://pbs.twimg.com/media/CSp2VugWUAE2_73.png)

А ещё роботы читают ваши письма.

Но всем вроде даже нравится. [pic.twitter.com/iEhVqbWSRA](https://t.co/iEhVqbWSRA)

![](https://pbs.twimg.com/media/CSp2jnHWUAAfB2x.png)

Микроразметка для писем пока что поддерживается только гуглом.

Будущее? Будущее уже здесь.